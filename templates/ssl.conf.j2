{% if SYS_APACHE_VERSION == '2.2' and ansible_distribution == "CentOS" %}
LoadModule ssl_module /etc/httpd/modules/mod_ssl.so
{% endif %}

SSLSessionCache         shmcb:/var/cache/mod_ssl/scache(512000)
SSLSessionCacheTimeout  300

# generated by https://mozilla.github.io/server-side-tls/ssl-config-generator/
# add to prevent insecure ciphers :!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4

# see also https://raymii.org/s/tutorials/Strong_SSL_Security_On_Apache2.html

# check with: https://www.ssllabs.com/ssltest/analyze.html?d=<domain_name>

{% if SYS_APACHE_VERSION == '2.2' %}
	SSLProtocol             all -SSLv2 -SSLv3
	SSLCipherSuite          ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4
	SSLHonorCipherOrder     on
	SSLMutex default
{% endif %}

{% if SYS_APACHE_VERSION == '2.4' %}
	{% if APACHE_SSL_HIGHSEC %}
		# modern configuration, tweak to your needs

		SSLProtocol             all -SSLv3 -TLSv1 -TLSv1.1
		SSLCipherSuite          ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4
		SSLHonorCipherOrder     on
		SSLCompression          off
		
		
		# OCSP Stapling, only in httpd 2.3.3 and later
		SSLUseStapling          on
		SSLStaplingResponderTimeout 5
		SSLStaplingReturnResponderErrors off
		SSLStaplingCache        shmcb:/var/run/ocsp(128000)
	
	{% else %}
		# intermediate configuration, tweak to your needs

		SSLProtocol             all -SSLv3
		SSLCipherSuite          ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4
		SSLHonorCipherOrder     on
		SSLCompression          off
		
		
		# OCSP Stapling, only in httpd 2.3.3 and later
		SSLUseStapling          on
		SSLStaplingResponderTimeout 5
		SSLStaplingReturnResponderErrors off
		SSLStaplingCache        shmcb:/var/run/ocsp(128000)

	{% endif %}

{% endif %}
